<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bonwaz - Le Coin des Bonnes Affaires</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Nunito Sans', sans-serif;
            background-color: #f4f6f7;
            color: #1a1a1a;
        }
        .text-lbc { color: #2563EB; } 
        .bg-lbc { background-color: #2563EB; }
        .bg-lbc-hover { background-color: #1D4ED8; }
        .border-lbc { border-color: #2563EB; }
        .bubble-user { background-color: #2563EB; color: white; border-radius: 18px 18px 0 18px; }
        .bubble-other { background-color: #E5E7EB; color: #1F2937; border-radius: 18px 18px 18px 0; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Floating Action Button Animation */
        .fab-animation { animation: bounce-in 0.5s; }
        @keyframes bounce-in {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">

        // --- ICONS ---
        const PlusIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>;
        const SearchIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>;
        const HeartIcon = ({ className, filled }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill={filled ? "currentColor" : "none"} viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>;
        const BellIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>;
        const MessageIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" /></svg>;
        const UserIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>;
        const LocationIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>;
        const LogoutIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>;
        const TrashIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>;
        const CameraIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>;
        const EyeIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>;
        const EyeOffIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21" /></svg>;
        const ShieldIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>;
        const UploadIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>;
        const WhatsAppIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>;
        const ArrowLeftIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>;
        const SendIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>;
        const PhoneIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" /></svg>;
        const PencilIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>;
        const CheckIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>;
        const StarIcon = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="currentColor"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>;


        // LOGO
        const Logo = () => (
            <div className="flex items-center gap-2 group cursor-pointer">
                <div className="relative bg-gradient-to-br from-blue-600 to-blue-400 text-white p-1.5 rounded-lg shadow-sm group-hover:shadow-md transition-all duration-300 transform group-hover:-rotate-3">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" />
                    </svg>
                </div>
                <div className="flex items-baseline leading-none select-none">
                    <span className="text-2xl font-black tracking-tighter text-gray-800">Bon</span>
                    <span className="text-2xl font-black tracking-tighter text-lbc">waz</span>
                    <span className="w-2 h-2 rounded-full bg-green-500 ml-0.5 mb-1 animate-pulse"></span>
                </div>
            </div>
        );

        // --- DATA ---
        const CATEGORIES = [
            { name: "Immobilier", icon: "üè†" },
            { name: "V√©hicules", icon: "üöó" },
            { name: "Terrains", icon: "üå≥" }, 
            { name: "Emploi", icon: "üíº" },
            { name: "Mode", icon: "üëó" },
            { name: "Maison", icon: "üõãÔ∏è" },
            { name: "T√©l√©phones", icon: "üì±" }, 
            { name: "Services", icon: "üõ†Ô∏è" },
            { name: "Animaux", icon: "üê∂" },
            { name: "Mat√©riel Pro", icon: "üèóÔ∏è" },
        ];

        // Base de donn√©es simul√©e pour l'autocompl√©tion
        const ALL_LOCATIONS = [
            "Libreville, Gabon", "Owendo, Gabon", "Akanda, Gabon", "Port-Gentil, Gabon", "Franceville, Gabon", "Oyem, Gabon", "Mouila, Gabon",
            "Douala, Cameroun", "Yaound√©, Cameroun", "Bafoussam, Cameroun", "Garoua, Cameroun", "Kribi, Cameroun", "Maroua, Cameroun", "Bamenda, Cameroun",
            "Brazzaville, Congo", "Pointe-Noire, Congo", "Dolisie, Congo",
            "N'Djam√©na, Tchad", "Moundou, Tchad",
            "Bangui, RCA", "Bimbo, RCA",
            "Malabo, Guin√©e √âquatoriale", "Bata, Guin√©e √âquatoriale",
            "Kinshasa, RDC", "Lubumbashi, RDC", "Goma, RDC"
        ];

        const INITIAL_LISTINGS = [
            {
                id: 1,
                title: "Appartement haut standing Akwa avec g√©n√©rateur",
                category: "Immobilier",
                price: "250 000 FCFA",
                location: "Douala, Akwa",
                date: "Aujourd'hui, 10:32",
                image: "https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?auto=format&fit=crop&w=800&q=80",
                description: "Magnifique appartement 3 chambres, 2 douches, cuisine √©quip√©e. Groupe √©lectrog√®ne automatique. Gardiennage 24/7. Id√©al pour expatri√©s ou cadres.",
                seller: "Agence Immo Prestige",
                isPro: true,
                verified: true,
                isSponsored: true
            },
            {
                id: 2,
                title: "Toyota Yaris 2018 - Climatis√©e - Occasion Europe",
                category: "V√©hicules",
                price: "4 500 000 FCFA",
                location: "Libreville, Centre",
                date: "Aujourd'hui, 09:45",
                image: "https://images.unsplash.com/photo-1590362891991-f776e747a588?auto=format&fit=crop&w=800&q=80",
                description: "Toyota Yaris ann√©e 2018, moteur essence VVTi, bo√Æte automatique. Clim d'origine qui glace. 85.000km au compteur. D√©douan√©e et immatricul√©e.",
                seller: "Auto Occaz Gabon",
                isPro: false,
                verified: true,
                isSponsored: false
            },
            {
                id: 3,
                title: "Salon complet en cuir import√© (N√©gociable)",
                category: "Maison",
                price: "350 000 FCFA",
                location: "Yaound√©, Bastos",
                date: "Hier, 22:15",
                image: "https://images.unsplash.com/photo-1555041469-a586c61ea9bc?auto=format&fit=crop&w=800&q=80",
                description: "Je vends mon salon complet cause d√©m√©nagement. Cuir v√©ritable import√© d'Italie. Comprend 1 canap√© 3 places et 2 fauteuils. √âtat impeccable.",
                seller: "Marie T.",
                isPro: false,
                verified: false,
                isSponsored: false
            },
            {
                id: 4,
                title: "iPhone 13 Pro Max 256Go - Propre avec carton",
                category: "Multim√©dia",
                price: "450 000 FCFA",
                location: "Pointe-Noire, Congo",
                date: "Hier, 18:30",
                image: "https://images.unsplash.com/photo-1510557880182-3d4d3cba35a5?auto=format&fit=crop&w=800&q=80",
                description: "Iphone 13 Pro Max 256Go Bleu Alpin. Batterie 92%. Vendu avec carton et c√¢ble d'origine. Pas de troc.",
                seller: "Tech Zone 242",
                isPro: true,
                verified: true,
                isSponsored: true
            },
            {
                id: 5,
                title: "Terrain titr√© 500m¬≤ - Kribi bord de mer",
                category: "Immobilier",
                price: "12 000 000 FCFA",
                location: "Kribi, Cameroun",
                date: "Aujourd'hui, 11:05",
                image: "https://images.unsplash.com/photo-1500382017468-9049fed747ef?auto=format&fit=crop&w=800&q=80",
                description: "Opportunit√© √† saisir. Terrain titr√© loti √† 200m de la plage. Zone r√©sidentielle calme. Id√©al pour projet h√¥telier ou r√©sidence secondaire.",
                seller: "Jean-Pierre K.",
                isPro: false,
                verified: true,
                isSponsored: false
            },
            {
                id: 6,
                title: "Groupe √©lectrog√®ne silencieux 5KVA",
                category: "Mat√©riel Pro",
                price: "200 000 FCFA",
                location: "N'Djam√©na, Tchad",
                date: "Aujourd'hui, 08:20",
                image: "https://images.unsplash.com/photo-1581092921461-eab62e97a78b?auto=format&fit=crop&w=800&q=80",
                description: "Groupe diesel 5KVA insonoris√©. Marque Perkins. Tr√®s peu servi. D√©marre au quart de tour.",
                seller: "Entreprise BTP",
                isPro: true,
                verified: true,
                isSponsored: true
            },
            {
                id: 7,
                title: "PlayStation 5 avec 2 manettes",
                category: "Multim√©dia",
                price: "350 000 FCFA",
                location: "Brazzaville, Congo",
                date: "Hier, 14:10",
                image: "https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?auto=format&fit=crop&w=800&q=80",
                description: "PS5 version disque, livr√©e avec 2 manettes DualSense et FIFA 24 install√©. Prix fixe.",
                seller: "Junior Gamer",
                isPro: false,
                verified: false,
                isSponsored: false
            }
        ];

        // --- COMPONENTS ---

        const Header = ({ user, onGoHome, onLogin, onFavorites, onMessages, onAlerts, onCreateListing, onProfile }) => {
            return (
                <header className="sticky top-0 z-50 bg-white shadow-sm">
                    <div className="max-w-[1064px] mx-auto px-4 h-16 flex items-center justify-between gap-6">
                        
                        {/* Logo Area */}
                        <div className="flex items-center gap-6">
                             <div onClick={onGoHome}>
                                <Logo />
                             </div>
                            
                            {/* Desktop Nav */}
                            <nav className="hidden lg:flex items-center gap-6 text-sm font-semibold text-gray-700">
                                <button onClick={onCreateListing} className="flex items-center gap-2 bg-lbc text-white px-4 py-2 rounded-xl hover:bg-lbc-hover transition font-bold shadow-md transform hover:scale-105">
                                    <PlusIcon className="h-5 w-5" />
                                    D√©poser une annonce
                                </button>
                                <a href="#" onClick={onGoHome} className="hover:text-black">Rechercher</a>
                            </nav>
                        </div>

                        {/* Right Actions */}
                        <div className="flex items-center gap-6 text-sm text-gray-700 font-semibold">
                             <button onClick={onAlerts} className="hidden md:flex flex-col items-center gap-1 hover:text-black">
                                <BellIcon className="h-6 w-6" />
                                <span className="text-xs font-normal">Alertes</span>
                            </button>
                            <button onClick={onFavorites} className="hidden md:flex flex-col items-center gap-1 hover:text-black">
                                <HeartIcon className="h-6 w-6" />
                                <span className="text-xs font-normal">Favoris</span>
                            </button>
                            <button onClick={onMessages} className="hidden md:flex flex-col items-center gap-1 hover:text-black">
                                <MessageIcon className="h-6 w-6" />
                                <span className="text-xs font-normal">Messages</span>
                            </button>
                            
                            {user ? (
                                <button onClick={onProfile} className="flex items-center gap-2 hover:text-black cursor-pointer border-l pl-6 ml-2 border-gray-200">
                                    <div className="w-8 h-8 rounded-full overflow-hidden border border-blue-200 flex-shrink-0">
                                        {user.avatar ? (
                                            <img src={user.avatar} alt="Avatar" className="w-full h-full object-cover" />
                                        ) : (
                                            <div className="w-full h-full bg-blue-100 flex items-center justify-center text-xs font-bold text-lbc">
                                                {user.name.charAt(0)}
                                            </div>
                                        )}
                                    </div>
                                    <span className="text-xs font-normal hidden md:block max-w-[100px] truncate">{user.name}</span>
                                </button>
                            ) : (
                                <button onClick={onLogin} className="flex flex-col items-center gap-1 hover:text-black cursor-pointer border-l pl-6 ml-2 border-gray-200">
                                    <UserIcon className="h-6 w-6" />
                                    <span className="text-xs font-normal hidden md:block">Connexion</span>
                                </button>
                            )}
                        </div>
                    </div>
                </header>
            );
        };

        const TrustBanner = () => (
            <div className="bg-blue-50 border-b border-blue-100 py-3">
                <div className="max-w-[1064px] mx-auto px-4 flex flex-wrap justify-center md:justify-between items-center gap-4 text-sm text-gray-700">
                    <div className="flex items-center gap-2">
                        <div className="bg-white p-1 rounded-full text-green-600"><ShieldIcon className="h-5 w-5" /></div>
                        <span className="font-semibold">Vendeurs v√©rifi√©s</span>
                    </div>
                    <div className="flex items-center gap-2"><span className="text-gray-400">|</span><span>Paiement √† la livraison ou Mobile Money</span></div>
                    <div className="hidden md:flex items-center gap-2"><span className="text-gray-400">|</span><span>Service client WhatsApp 24/7</span></div>
                </div>
            </div>
        );

        // --- INSTITUTIONAL PAGES ---

        const AboutPage = ({ onBack }) => (
            <div className="max-w-4xl mx-auto px-4 py-8">
                <button onClick={onBack} className="flex items-center gap-2 text-gray-600 hover:text-black mb-6"><ArrowLeftIcon className="h-5 w-5" /> Retour</button>
                <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-200">
                    <h2 className="text-3xl font-bold text-gray-900 mb-6">Qui sommes-nous ?</h2>
                    <p className="text-lg text-gray-700 mb-4">
                        <strong>Bonwaz</strong> est la plateforme de r√©f√©rence pour les petites annonces en Afrique Centrale. N√©e de la volont√© de simplifier les √©changes commerciaux entre particuliers et professionnels, nous op√©rons au Gabon, au Cameroun, au Congo et au Tchad.
                    </p>
                    <p className="text-gray-700 mb-4">
                        Notre mission est double :
                    </p>
                    <ul className="list-disc list-inside text-gray-700 mb-4 space-y-2">
                        <li>Offrir une plateforme <strong>s√©curis√©e</strong> et facile d'utilisation pour vendre tout ce dont vous n'avez plus besoin.</li>
                        <li>Permettre √† chacun de trouver la bonne affaire pr√®s de chez soi, sans interm√©diaire co√ªteux.</li>
                    </ul>
                    <p className="text-gray-700">
                        Chez Bonwaz, nous croyons en la force du commerce local pour dynamiser nos √©conomies.
                    </p>
                </div>
            </div>
        );

        const PartnersPage = ({ onBack }) => (
            <div className="max-w-4xl mx-auto px-4 py-8">
                <button onClick={onBack} className="flex items-center gap-2 text-gray-600 hover:text-black mb-6"><ArrowLeftIcon className="h-5 w-5" /> Retour</button>
                <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-200 text-center">
                    <h2 className="text-3xl font-bold text-gray-900 mb-8">Nos Partenaires</h2>
                    <p className="text-gray-600 mb-8 max-w-2xl mx-auto">Ils nous font confiance pour faciliter vos paiements et s√©curiser vos transactions √† travers toute la r√©gion.</p>
                    
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-8 items-center">
                        <div className="p-4 border rounded-xl hover:shadow-md transition">
                            <div className="h-16 w-16 bg-orange-500 rounded-full mx-auto mb-2"></div>
                            <span className="font-bold text-gray-800">Orange Money</span>
                        </div>
                        <div className="p-4 border rounded-xl hover:shadow-md transition">
                            <div className="h-16 w-16 bg-yellow-400 rounded-full mx-auto mb-2"></div>
                            <span className="font-bold text-gray-800">MTN MoMo</span>
                        </div>
                        <div className="p-4 border rounded-xl hover:shadow-md transition">
                            <div className="h-16 w-16 bg-red-600 rounded-full mx-auto mb-2"></div>
                            <span className="font-bold text-gray-800">Airtel Money</span>
                        </div>
                        <div className="p-4 border rounded-xl hover:shadow-md transition">
                            <div className="h-16 w-16 bg-blue-600 rounded-full mx-auto mb-2"></div>
                            <span className="font-bold text-gray-800">Moov Money</span>
                        </div>
                    </div>
                </div>
            </div>
        );

        const AntiScamPage = ({ onBack }) => (
            <div className="max-w-4xl mx-auto px-4 py-8">
                <button onClick={onBack} className="flex items-center gap-2 text-gray-600 hover:text-black mb-6"><ArrowLeftIcon className="h-5 w-5" /> Retour</button>
                <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-200">
                    <div className="flex items-center gap-3 mb-6">
                        <ShieldIcon className="h-10 w-10 text-lbc" />
                        <h2 className="text-3xl font-bold text-gray-900">Conseils Anti-Arnaque</h2>
                    </div>
                    
                    <div className="space-y-6">
                        <div className="bg-red-50 p-4 rounded-xl border border-red-100">
                            <h3 className="font-bold text-red-800 text-lg mb-2">‚ö†Ô∏è La r√®gle d'or</h3>
                            <p className="text-red-700">Ne payez jamais √† l'avance ! Privil√©giez toujours la remise en main propre dans un lieu public.</p>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="p-4 border border-gray-200 rounded-xl">
                                <h4 className="font-bold text-gray-800 mb-2">M√©fiez-vous des prix trop bas</h4>
                                <p className="text-sm text-gray-600">Si une offre semble trop belle pour √™tre vraie (iPhone 14 √† 50.000 FCFA), c'est probablement une arnaque.</p>
                            </div>
                             <div className="p-4 border border-gray-200 rounded-xl">
                                <h4 className="font-bold text-gray-800 mb-2">Refusez les transferts internationaux</h4>
                                <p className="text-sm text-gray-600">N'acceptez jamais de paiements via Western Union, MoneyGram ou des coupons PCS pour des transactions locales.</p>
                            </div>
                             <div className="p-4 border border-gray-200 rounded-xl">
                                <h4 className="font-bold text-gray-800 mb-2">V√©rifiez le num√©ro</h4>
                                <p className="text-sm text-gray-600">Utilisez notre outil "V√©rifier un num√©ro" en bas de page pour voir si le vendeur a √©t√© signal√©.</p>
                            </div>
                             <div className="p-4 border border-gray-200 rounded-xl">
                                <h4 className="font-bold text-gray-800 mb-2">Discutez sur la plateforme</h4>
                                <p className="text-sm text-gray-600">Essayez de garder les traces √©crites sur la messagerie Bonwaz autant que possible.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const VerifyNumberPage = ({ onBack }) => {
            const [number, setNumber] = React.useState("");
            const [status, setStatus] = React.useState(null); // 'loading', 'verified', 'unknown', 'scam'

            const handleVerify = (e) => {
                e.preventDefault();
                setStatus('loading');
                setTimeout(() => {
                    // Simulation simple
                    if (number.includes('000')) setStatus('scam');
                    else if (number.includes('123')) setStatus('verified');
                    else setStatus('unknown');
                }, 1500);
            };

            return (
                <div className="max-w-2xl mx-auto px-4 py-8">
                    <button onClick={onBack} className="flex items-center gap-2 text-gray-600 hover:text-black mb-6"><ArrowLeftIcon className="h-5 w-5" /> Retour</button>
                    <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-200 text-center">
                        <ShieldIcon className="h-12 w-12 text-lbc mx-auto mb-4" />
                        <h2 className="text-2xl font-bold text-gray-900 mb-2">V√©rifier un num√©ro</h2>
                        <p className="text-gray-500 mb-6">Saisissez le num√©ro du vendeur pour v√©rifier s'il est connu de nos services ou signal√©.</p>

                        <form onSubmit={handleVerify} className="max-w-sm mx-auto mb-8">
                            <input 
                                type="text" 
                                value={number}
                                onChange={(e) => setNumber(e.target.value)}
                                className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none mb-3 text-center text-lg tracking-widest"
                                placeholder="07 00 00 00"
                                required
                            />
                            <button type="submit" className="w-full bg-lbc text-white font-bold py-3 rounded-xl hover:bg-lbc-hover transition">
                                V√©rifier maintenant
                            </button>
                        </form>

                        {status === 'loading' && <p className="text-gray-500 animate-pulse">Analyse en cours...</p>}
                        
                        {status === 'verified' && (
                            <div className="bg-green-50 p-4 rounded-xl border border-green-200">
                                <h3 className="text-green-800 font-bold flex items-center justify-center gap-2"><CheckIcon className="h-5 w-5" /> Num√©ro de confiance</h3>
                                <p className="text-green-700 text-sm mt-1">Ce vendeur a effectu√© plusieurs transactions r√©ussies et a v√©rifi√© son identit√©.</p>
                            </div>
                        )}
                         {status === 'unknown' && (
                            <div className="bg-gray-50 p-4 rounded-xl border border-gray-200">
                                <h3 className="text-gray-800 font-bold">Num√©ro inconnu</h3>
                                <p className="text-gray-600 text-sm mt-1">Nous n'avons pas assez de donn√©es. Soyez prudent et respectez les r√®gles anti-arnaque.</p>
                            </div>
                        )}
                         {status === 'scam' && (
                            <div className="bg-red-50 p-4 rounded-xl border border-red-200">
                                <h3 className="text-red-800 font-bold flex items-center justify-center gap-2">‚ö†Ô∏è Num√©ro signal√© !</h3>
                                <p className="text-red-700 text-sm mt-1">Ce num√©ro a √©t√© signal√© comme suspect par plusieurs utilisateurs. Ne faites pas affaire avec cette personne.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const ContactPage = ({ onBack }) => (
            <div className="max-w-2xl mx-auto px-4 py-8">
                <button onClick={onBack} className="flex items-center gap-2 text-gray-600 hover:text-black mb-6"><ArrowLeftIcon className="h-5 w-5" /> Retour</button>
                <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-200">
                    <h2 className="text-2xl font-bold text-gray-900 mb-6">Contactez-nous</h2>
                    <form className="space-y-4" onSubmit={(e) => { e.preventDefault(); alert("Message envoy√© !"); onBack(); }}>
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">Votre Email</label>
                            <input type="email" required className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 outline-none" />
                        </div>
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">Sujet</label>
                            <select className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 outline-none">
                                <option>Probl√®me technique</option>
                                <option>Question sur mon compte</option>
                                <option>Partenariat</option>
                                <option>Autre</option>
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">Message</label>
                            <textarea rows="4" required className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 outline-none"></textarea>
                        </div>
                        <button type="submit" className="w-full bg-lbc text-white font-bold py-3 rounded-xl hover:bg-lbc-hover transition">Envoyer le message</button>
                    </form>
                    <div className="mt-8 pt-6 border-t border-gray-100 text-center">
                        <p className="text-sm text-gray-500">Ou √©crivez-nous directement sur WhatsApp :</p>
                        <button className="text-green-600 font-bold mt-2 hover:underline">+241 00 00 00 00</button>
                    </div>
                </div>
            </div>
        );

        const ReportPage = ({ onBack }) => (
            <div className="max-w-2xl mx-auto px-4 py-8">
                <button onClick={onBack} className="flex items-center gap-2 text-gray-600 hover:text-black mb-6"><ArrowLeftIcon className="h-5 w-5" /> Retour</button>
                <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-200">
                    <h2 className="text-2xl font-bold text-red-600 mb-6 flex items-center gap-2"><ShieldIcon className="h-6 w-6" /> Signaler une annonce ou un utilisateur</h2>
                    <form className="space-y-4" onSubmit={(e) => { e.preventDefault(); alert("Signalement enregistr√©. Nous allons enqu√™ter."); onBack(); }}>
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">Lien de l'annonce ou Nom de l'utilisateur</label>
                            <input type="text" placeholder="Ex: https://bonwaz.com/annonce/123" required className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 outline-none" />
                        </div>
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">Motif du signalement</label>
                            <select className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 outline-none">
                                <option>Arnaque / Tentative de fraude</option>
                                <option>Article interdit</option>
                                <option>Contenu inappropri√© / Insultes</option>
                                <option>Contrefa√ßon</option>
                                <option>Autre</option>
                            </select>
                        </div>
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-1">D√©tails (Preuves, explications)</label>
                            <textarea rows="4" placeholder="Expliquez-nous le probl√®me..." required className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 outline-none"></textarea>
                        </div>
                        <button type="submit" className="w-full bg-red-600 text-white font-bold py-3 rounded-xl hover:bg-red-700 transition">Envoyer le signalement</button>
                    </form>
                </div>
            </div>
        );

        const TermsPage = ({ onBack }) => (
            <div className="max-w-4xl mx-auto px-4 py-8">
                <button onClick={onBack} className="flex items-center gap-2 text-gray-600 hover:text-black mb-6"><ArrowLeftIcon className="h-5 w-5" /> Retour</button>
                <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-200 text-gray-800">
                    <h1 className="text-3xl font-bold text-gray-900 mb-8">Conditions G√©n√©rales d'Utilisation (CGU)</h1>
                    
                    <div className="space-y-8">
                        <section>
                            <h2 className="text-xl font-bold text-lbc mb-3">1. Acceptation des Conditions</h2>
                            <p className="text-gray-600 leading-relaxed">
                                En acc√©dant et en utilisant la plateforme Bonwaz, vous acceptez sans r√©serve les pr√©sentes Conditions G√©n√©rales d'Utilisation. Ces conditions s'appliquent √† tous les visiteurs, utilisateurs et autres personnes qui acc√®dent ou utilisent le service.
                            </p>
                        </section>

                        <section>
                            <h2 className="text-xl font-bold text-lbc mb-3">2. Description du Service</h2>
                            <p className="text-gray-600 leading-relaxed">
                                Bonwaz est une plateforme de mise en relation entre vendeurs (particuliers ou professionnels) et acheteurs en Afrique Centrale (Gabon, Cameroun, Congo, Tchad, etc.). Bonwaz n'est pas propri√©taire des objets mis en vente et n'intervient pas dans la transaction financi√®re directe entre les parties, sauf indication contraire via des services de paiement s√©curis√©s partenaires.
                            </p>
                        </section>

                        <section>
                            <h2 className="text-xl font-bold text-lbc mb-3">3. R√®gles de Diffusion des Annonces</h2>
                            <ul className="list-disc list-inside text-gray-600 space-y-2 ml-2">
                                <li>L'annonceur certifie √™tre propri√©taire du bien vendu.</li>
                                <li>Les photos doivent √™tre contractuelles et repr√©senter r√©ellement l'objet.</li>
                                <li>Il est interdit de vendre des produits illicites, contrefaits, ou dangereux.</li>
                                <li>Bonwaz se r√©serve le droit de supprimer toute annonce jug√©e inappropri√©e ou frauduleuse sans pr√©avis.</li>
                            </ul>
                        </section>

                        <section>
                            <h2 className="text-xl font-bold text-lbc mb-3">4. S√©curit√© et Responsabilit√©</h2>
                            <p className="text-gray-600 leading-relaxed mb-4">
                                <strong>Anti-Arnaque :</strong> Les utilisateurs sont tenus √† la vigilance. Ne payez jamais √† l'avance par des moyens non tra√ßables (Western Union, coupons, etc.) si vous n'avez pas vu l'objet.
                            </p>
                            <p className="text-gray-600 leading-relaxed">
                                Bonwaz ne saurait √™tre tenu responsable des litiges entre acheteurs et vendeurs, de la non-conformit√© des produits, ou des d√©fauts de paiement, bien que nous mettions tout en ≈ìuvre pour mod√©rer le contenu.
                            </p>
                        </section>

                        <section>
                            <h2 className="text-xl font-bold text-lbc mb-3">5. Donn√©es Personnelles</h2>
                            <p className="text-gray-600 leading-relaxed">
                                Les informations recueillies (nom, t√©l√©phone, localisation) sont n√©cessaires pour la mise en relation. Elles sont trait√©es conform√©ment aux lois en vigueur sur la protection des donn√©es personnelles. Vous disposez d'un droit d'acc√®s, de modification et de suppression de vos donn√©es via votre espace personnel.
                            </p>
                        </section>
                    </div>
                    
                    <div className="mt-12 p-4 bg-gray-50 rounded-xl border border-gray-100 text-sm text-gray-500 text-center">
                        Derni√®re mise √† jour : 25 Octobre 2023
                    </div>
                </div>
            </div>
        );

        // --- NEW PAGES ---

        const CreateListingPage = ({ onSubmit, onBack }) => {
            const [formData, setFormData] = React.useState({ title: '', category: 'V√©hicules', price: '', location: '', description: '' });
            const [loading, setLoading] = React.useState(false);
            const [imagePreview, setImagePreview] = React.useState(null);

            const handleChange = (e) => setFormData({ ...formData, [e.target.name]: e.target.value });

            const handleImageChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const imageUrl = URL.createObjectURL(file);
                    setImagePreview(imageUrl);
                }
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                setLoading(true);
                setTimeout(() => {
                    const newItem = {
                        id: Date.now(),
                        ...formData,
                        price: formData.price + " FCFA",
                        image: imagePreview || "https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80", 
                        seller: "Moi (Client Bonwaz)",
                        isPro: false,
                        verified: true,
                        date: "√Ä l'instant",
                        isSponsored: false // Par d√©faut
                    };
                    onSubmit(newItem);
                    setLoading(false);
                }, 1500);
            };

            return (
                <div className="max-w-2xl mx-auto px-4 py-8">
                    <button onClick={onBack} className="flex items-center gap-2 text-gray-600 hover:text-black mb-6"><ArrowLeftIcon className="h-5 w-5" /> Retour</button>
                    <h2 className="text-3xl font-bold text-gray-900 mb-8">D√©poser une annonce</h2>
                    <form onSubmit={handleSubmit} className="bg-white p-6 rounded-2xl shadow-sm border border-gray-200 space-y-6">
                        
                        {/* Photo Upload */}
                        <div className="border-2 border-dashed border-gray-300 rounded-xl p-8 flex flex-col items-center justify-center text-gray-500 cursor-pointer hover:bg-gray-50 hover:border-lbc transition relative overflow-hidden group">
                            <input type="file" onChange={handleImageChange} className="absolute inset-0 opacity-0 cursor-pointer z-20" accept="image/*" />
                            {imagePreview ? (
                                <img src={imagePreview} className="absolute inset-0 w-full h-full object-cover z-10" />
                            ) : (
                                <>
                                    <CameraIcon className="h-10 w-10 mb-2" />
                                    <span className="font-semibold">Ajouter des photos</span>
                                    <p className="text-xs mt-2 text-gray-400">Cliquez ou glissez une image ici</p>
                                </>
                            )}
                            {imagePreview && (
                                <div className="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition z-20 pointer-events-none">
                                    <span className="text-white font-bold">Changer la photo</span>
                                </div>
                            )}
                        </div>

                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-2">Titre de l'annonce</label>
                            <input name="title" required value={formData.title} onChange={handleChange} className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ex: Samsung Galaxy S21" />
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Cat√©gorie</label>
                                <select name="category" value={formData.category} onChange={handleChange} className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 outline-none">
                                    {CATEGORIES.map(c => <option key={c.name} value={c.name}>{c.name}</option>)}
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-2">Prix (FCFA)</label>
                                <input name="price" type="number" required value={formData.price} onChange={handleChange} className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ex: 150000" />
                            </div>
                        </div>
                        <div>
                             <label className="block text-sm font-bold text-gray-700 mb-2">Ville / Quartier</label>
                             <input name="location" required value={formData.location} onChange={handleChange} className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Ex: Yaound√©, Biyem-Assi" />
                        </div>
                        <div>
                            <label className="block text-sm font-bold text-gray-700 mb-2">Description</label>
                            <textarea name="description" required rows="4" value={formData.description} onChange={handleChange} className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="D√©crivez votre article en d√©tail..."></textarea>
                        </div>
                        <button type="submit" disabled={loading} className={`w-full bg-lbc text-white py-4 rounded-xl font-bold text-lg hover:bg-lbc-hover transition ${loading ? 'opacity-50' : ''}`}>
                            {loading ? "Publication en cours..." : "Publier mon annonce"}
                        </button>
                    </form>
                </div>
            );
        };

        const AlertsPage = ({ onBack }) => (
            <div className="max-w-[1064px] mx-auto px-4 py-8 min-h-screen">
                <div className="flex items-center gap-4 mb-8">
                    <button onClick={onBack}><ArrowLeftIcon className="h-6 w-6 text-gray-600" /></button>
                    <h2 className="text-2xl font-bold text-gray-900">Mes Alertes</h2>
                </div>
                <div className="bg-white rounded-2xl border border-gray-200 p-8 text-center">
                    <BellIcon className="h-16 w-16 text-gray-200 mx-auto mb-4" />
                    <h3 className="text-xl font-bold text-gray-800 mb-2">Pas de nouvelles alertes</h3>
                    <p className="text-gray-500 mb-6">Cr√©ez une alerte de recherche pour ne rien rater.</p>
                    <button onClick={onBack} className="text-lbc font-bold hover:underline">Retourner √† l'accueil</button>
                </div>
            </div>
        );

        const ProfilePage = ({ user, userListings, onLogout, onBack, onUpdateProfile, onStartVerification }) => {
            const [isEditing, setIsEditing] = React.useState(false);
            const [editForm, setEditForm] = React.useState({ 
                name: user.name || "", 
                bio: user.bio || "", 
                location: user.location || "", 
                phone: user.phone || "" 
            });
            const [avatarPreview, setAvatarPreview] = React.useState(user.avatar || null);

            const handleEditChange = (e) => setEditForm({ ...editForm, [e.target.name]: e.target.value });

            const handleAvatarChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const url = URL.createObjectURL(file);
                    setAvatarPreview(url);
                }
            };

            const handleSaveProfile = (e) => {
                e.preventDefault();
                onUpdateProfile({ ...user, ...editForm, avatar: avatarPreview });
                setIsEditing(false);
            };

            // Status Logic
            const getVerificationStatusUI = () => {
                switch(user.verificationStatus) {
                    case 'verified':
                        return <div className="flex items-center gap-2 text-green-600 bg-green-50 px-3 py-1 rounded-full text-xs font-bold mt-2"><ShieldIcon className="h-4 w-4" /> Profil v√©rifi√©</div>;
                    case 'pending':
                        return <div className="flex items-center gap-2 text-yellow-600 bg-yellow-50 px-3 py-1 rounded-full text-xs font-bold mt-2"><ShieldIcon className="h-4 w-4" /> En cours d'analyse</div>;
                    case 'rejected':
                        return <div className="flex items-center gap-2 text-red-600 bg-red-50 px-3 py-1 rounded-full text-xs font-bold mt-2"><ShieldIcon className="h-4 w-4" /> V√©rification refus√©e</div>;
                    default:
                        return <div className="flex items-center gap-2 text-gray-500 bg-gray-100 px-3 py-1 rounded-full text-xs font-bold mt-2"><ShieldIcon className="h-4 w-4" /> Non v√©rifi√©</div>;
                }
            };

            return (
                <div className="max-w-[1064px] mx-auto px-4 py-8 min-h-screen">
                    <div className="flex items-center gap-4 mb-8">
                        <button onClick={onBack}><ArrowLeftIcon className="h-6 w-6 text-gray-600" /></button>
                        <h2 className="text-2xl font-bold text-gray-900">Mon Profil</h2>
                    </div>
                    
                    <div className="grid md:grid-cols-3 gap-8">
                        {/* Sidebar / User Card */}
                        <div className="space-y-6">
                            <div className="bg-white p-6 rounded-2xl border border-gray-200 flex flex-col items-center text-center relative overflow-hidden">
                                <div className="absolute top-0 left-0 w-full h-24 bg-gradient-to-r from-blue-400 to-blue-600"></div>
                                
                                <div className="relative mt-12 mb-4 group">
                                    <div className="w-32 h-32 rounded-full border-4 border-white shadow-lg overflow-hidden bg-white">
                                        {avatarPreview ? (
                                            <img src={avatarPreview} className="w-full h-full object-cover" />
                                        ) : (
                                            <div className="w-full h-full bg-blue-100 flex items-center justify-center text-lbc font-bold text-5xl">
                                                {user.name.charAt(0)}
                                            </div>
                                        )}
                                    </div>
                                    {isEditing && (
                                        <label className="absolute bottom-0 right-0 bg-white p-2 rounded-full shadow-md cursor-pointer hover:bg-gray-100 border border-gray-200">
                                            <CameraIcon className="h-5 w-5 text-gray-700" />
                                            <input type="file" onChange={handleAvatarChange} className="hidden" accept="image/*" />
                                        </label>
                                    )}
                                </div>

                                {!isEditing ? (
                                    <>
                                        <h3 className="text-2xl font-bold text-gray-900">{user.name}</h3>
                                        
                                        {/* Verification Status */}
                                        {getVerificationStatusUI()}

                                        {user.location && <p className="text-gray-500 text-sm mt-3 flex items-center gap-1"><LocationIcon className="h-4 w-4" /> {user.location}</p>}
                                        {user.bio && <p className="text-gray-600 text-sm mt-4 px-4 italic">"{user.bio}"</p>}
                                        
                                        <div className="w-full grid grid-cols-3 gap-2 mt-6 border-t border-gray-100 pt-4">
                                            <div><span className="block font-bold text-lg text-gray-800">{userListings.length}</span><span className="text-xs text-gray-500">Annonces</span></div>
                                            <div><span className="block font-bold text-lg text-gray-800">0</span><span className="text-xs text-gray-500">Ventes</span></div>
                                            <div><span className="block font-bold text-lg text-gray-800">-</span><span className="text-xs text-gray-500">Avis</span></div>
                                        </div>

                                        {/* Action Buttons */}
                                        <div className="w-full space-y-3 mt-6">
                                            {(user.verificationStatus === 'none' || user.verificationStatus === 'rejected') && (
                                                <button onClick={onStartVerification} className="w-full bg-blue-50 text-lbc border border-blue-200 font-bold py-2 rounded-xl hover:bg-blue-100 transition flex items-center justify-center gap-2">
                                                    <ShieldIcon className="h-5 w-5" /> Obtenir le badge v√©rifi√©
                                                </button>
                                            )}
                                            
                                            <button onClick={() => setIsEditing(true)} className="w-full bg-gray-100 text-gray-700 font-bold py-2 rounded-xl hover:bg-gray-200 transition flex items-center justify-center gap-2">
                                                <PencilIcon className="h-4 w-4" /> Modifier le profil
                                            </button>
                                        </div>
                                    </>
                                ) : (
                                    <form onSubmit={handleSaveProfile} className="w-full space-y-4 mt-2">
                                        <input 
                                            name="name" 
                                            value={editForm.name} 
                                            onChange={handleEditChange}
                                            className="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50"
                                            placeholder="Votre nom"
                                            required
                                        />
                                        <input 
                                            name="location" 
                                            value={editForm.location} 
                                            onChange={handleEditChange}
                                            className="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50"
                                            placeholder="Ville, Pays"
                                        />
                                        <input 
                                            name="phone" 
                                            value={editForm.phone} 
                                            onChange={handleEditChange}
                                            className="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50"
                                            placeholder="T√©l√©phone"
                                        />
                                        <textarea 
                                            name="bio" 
                                            value={editForm.bio} 
                                            onChange={handleEditChange}
                                            className="w-full px-3 py-2 border rounded-lg text-sm bg-gray-50"
                                            placeholder="Petite bio pour vos acheteurs..."
                                            rows="3"
                                        />
                                        <div className="flex gap-2">
                                            <button type="button" onClick={() => setIsEditing(false)} className="flex-1 py-2 bg-gray-200 rounded-lg text-sm font-bold text-gray-700">Annuler</button>
                                            <button type="submit" className="flex-1 py-2 bg-lbc rounded-lg text-sm font-bold text-white flex items-center justify-center gap-1"><CheckIcon className="h-4 w-4" /> Enregistrer</button>
                                        </div>
                                    </form>
                                )}
                            </div>
                            
                            <div className="bg-white rounded-2xl border border-gray-200 overflow-hidden">
                                <button onClick={onLogout} className="w-full text-left px-6 py-4 hover:bg-gray-50 text-red-600 font-bold flex items-center gap-3">
                                    <LogoutIcon className="h-5 w-5" /> Se d√©connecter
                                </button>
                            </div>
                        </div>

                        {/* Main Content */}
                        <div className="md:col-span-2 space-y-6">
                            
                            {/* User Info Block */}
                            {user.phone && !isEditing && (
                                <div className="bg-white p-6 rounded-2xl border border-gray-200">
                                    <h4 className="font-bold text-gray-900 mb-4">Informations de contact</h4>
                                    <div className="flex items-center gap-3 text-gray-700">
                                        <PhoneIcon className="h-5 w-5 text-gray-400" />
                                        <span>{user.phone}</span>
                                        <span className="text-xs bg-gray-100 px-2 py-0.5 rounded text-gray-500">Visible uniquement par les acheteurs</span>
                                    </div>
                                </div>
                            )}

                            <div>
                                <h3 className="text-xl font-bold text-gray-800 mb-4 flex items-center justify-between">
                                    <span>Mes annonces en ligne</span>
                                    <span className="text-sm font-normal text-gray-500 bg-gray-100 px-2 py-1 rounded-full">{userListings.length}</span>
                                </h3>
                                {userListings.length === 0 ? (
                                    <div className="bg-white p-12 rounded-2xl border border-gray-200 text-center">
                                        <p className="text-gray-500">Vous n'avez aucune annonce en ligne.</p>
                                    </div>
                                ) : (
                                    <div className="space-y-4">
                                        {userListings.map(item => (
                                            <div key={item.id} className="bg-white p-4 rounded-xl border border-gray-200 flex gap-4 group hover:shadow-md transition">
                                                <div className="w-24 h-24 bg-gray-200 rounded-lg flex-shrink-0 overflow-hidden">
                                                    <img src={item.image} className="w-full h-full object-cover group-hover:scale-105 transition" />
                                                </div>
                                                <div className="flex-1 flex flex-col justify-between">
                                                    <div>
                                                        <h4 className="font-bold text-gray-900 line-clamp-1">{item.title}</h4>
                                                        <p className="text-lbc font-bold">{item.price}</p>
                                                    </div>
                                                    <div className="flex justify-between items-end">
                                                        <div className="flex gap-2">
                                                            <span className="text-xs bg-green-100 text-green-700 px-2 py-1 rounded font-semibold">En ligne</span>
                                                            <span className="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded">{item.date}</span>
                                                        </div>
                                                        <button className="text-gray-400 hover:text-red-500 p-1 hover:bg-red-50 rounded"><TrashIcon className="h-5 w-5" /></button>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const VerificationPage = ({ onBack, onSubmitVerification }) => {
            const [step, setStep] = React.useState(1); // 1: Doc, 2: Selfie, 3: Success
            const [docType, setDocType] = React.useState("cni");
            const [docFront, setDocFront] = React.useState(null);
            const [docBack, setDocBack] = React.useState(null);
            const [selfie, setSelfie] = React.useState(null);
            const [isCameraActive, setIsCameraActive] = React.useState(false);
            const [loading, setLoading] = React.useState(false);

            // Helpers for simulated file upload
            const handleFileChange = (e, setter) => {
                const file = e.target.files[0];
                if (file) setter(URL.createObjectURL(file));
            };

            const handleTakeSelfie = () => {
                setLoading(true);
                // Simulate camera delay
                setTimeout(() => {
                    setSelfie("https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=400&q=80"); // Fake captured selfie
                    setLoading(false);
                    setIsCameraActive(false);
                }, 1500);
            };

            const handleFinalSubmit = () => {
                setLoading(true);
                setTimeout(() => {
                    setLoading(false);
                    setStep(3); // Success
                    onSubmitVerification(); // Update user status in parent
                }, 2000);
            };

            return (
                <div className="max-w-2xl mx-auto px-4 py-8 min-h-screen">
                    <button onClick={onBack} className="flex items-center gap-2 text-gray-600 hover:text-black mb-6"><ArrowLeftIcon className="h-5 w-5" /> Retour au profil</button>
                    
                    <div className="bg-white rounded-2xl p-8 shadow-sm border border-gray-200">
                        {/* Progress Bar */}
                        <div className="flex items-center justify-between mb-8 px-2">
                            <div className={`flex flex-col items-center gap-2 ${step >= 1 ? 'text-lbc' : 'text-gray-300'}`}>
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${step >= 1 ? 'bg-blue-100 text-lbc' : 'bg-gray-100 text-gray-400'}`}>1</div>
                                <span className="text-xs font-semibold">Identit√©</span>
                            </div>
                            <div className={`flex-1 h-1 mx-4 rounded ${step >= 2 ? 'bg-blue-200' : 'bg-gray-100'}`}></div>
                            <div className={`flex flex-col items-center gap-2 ${step >= 2 ? 'text-lbc' : 'text-gray-300'}`}>
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${step >= 2 ? 'bg-blue-100 text-lbc' : 'bg-gray-100 text-gray-400'}`}>2</div>
                                <span className="text-xs font-semibold">Selfie</span>
                            </div>
                            <div className={`flex-1 h-1 mx-4 rounded ${step >= 3 ? 'bg-blue-200' : 'bg-gray-100'}`}></div>
                            <div className={`flex flex-col items-center gap-2 ${step >= 3 ? 'text-lbc' : 'text-gray-300'}`}>
                                <div className={`w-8 h-8 rounded-full flex items-center justify-center font-bold text-sm ${step >= 3 ? 'bg-blue-100 text-lbc' : 'bg-gray-100 text-gray-400'}`}>3</div>
                                <span className="text-xs font-semibold">Validation</span>
                            </div>
                        </div>

                        {step === 1 && (
                            <div className="space-y-6">
                                <h2 className="text-2xl font-bold text-gray-900 text-center">√âtape 1 : Pi√®ce d'identit√©</h2>
                                <p className="text-gray-600 text-center text-sm">Importez une photo claire de votre pi√®ce d'identit√© (Recto/Verso).</p>
                                
                                <div>
                                    <label className="block text-sm font-bold text-gray-700 mb-2">Type de document</label>
                                    <select value={docType} onChange={(e) => setDocType(e.target.value)} className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-200 outline-none cursor-pointer">
                                        <option value="cni">Carte Nationale d'Identit√© (CNI)</option>
                                        <option value="passport">Passeport</option>
                                        <option value="permis">Permis de Conduire</option>
                                    </select>
                                </div>

                                <div className="grid md:grid-cols-2 gap-4">
                                    <div className="border-2 border-dashed border-gray-300 rounded-xl p-6 flex flex-col items-center justify-center text-center cursor-pointer hover:bg-gray-50 hover:border-lbc transition relative overflow-hidden group">
                                        <input type="file" onChange={(e) => handleFileChange(e, setDocFront)} className="absolute inset-0 opacity-0 cursor-pointer z-10" accept="image/*" />
                                        {docFront ? (
                                            <img src={docFront} className="w-full h-32 object-contain" />
                                        ) : (
                                            <>
                                                <UploadIcon className="h-8 w-8 text-gray-400 mb-2" />
                                                <span className="text-sm font-bold text-gray-600">Recto</span>
                                                <span className="text-xs text-gray-400">Cliquez pour ajouter</span>
                                            </>
                                        )}
                                    </div>
                                    
                                    <div className="border-2 border-dashed border-gray-300 rounded-xl p-6 flex flex-col items-center justify-center text-center cursor-pointer hover:bg-gray-50 hover:border-lbc transition relative overflow-hidden group">
                                        <input type="file" onChange={(e) => handleFileChange(e, setDocBack)} className="absolute inset-0 opacity-0 cursor-pointer z-10" accept="image/*" />
                                        {docBack ? (
                                            <img src={docBack} className="w-full h-32 object-contain" />
                                        ) : (
                                            <>
                                                <UploadIcon className="h-8 w-8 text-gray-400 mb-2" />
                                                <span className="text-sm font-bold text-gray-600">Verso</span>
                                                <span className="text-xs text-gray-400">Cliquez pour ajouter</span>
                                            </>
                                        )}
                                    </div>
                                </div>

                                <button 
                                    onClick={() => setStep(2)} 
                                    disabled={!docFront || !docBack}
                                    className={`w-full bg-lbc text-white py-3 rounded-xl font-bold transition hover:bg-lbc-hover ${(!docFront || !docBack) ? 'opacity-50 cursor-not-allowed' : ''}`}
                                >
                                    Suivant
                                </button>
                            </div>
                        )}

                        {step === 2 && (
                            <div className="space-y-6 text-center">
                                <h2 className="text-2xl font-bold text-gray-900">√âtape 2 : Selfie de s√©curit√©</h2>
                                <p className="text-gray-600 text-sm">Prenez une photo de vous pour prouver que vous √™tes bien le propri√©taire du document.</p>
                                
                                {!selfie && !isCameraActive && (
                                    <div className="bg-gray-100 h-64 rounded-2xl flex flex-col items-center justify-center mb-4">
                                        <CameraIcon className="h-16 w-16 text-gray-300 mb-4" />
                                        <button onClick={() => setIsCameraActive(true)} className="bg-lbc text-white px-6 py-2 rounded-full font-bold hover:bg-lbc-hover transition">
                                            Activer la cam√©ra
                                        </button>
                                    </div>
                                )}

                                {isCameraActive && !selfie && (
                                    <div className="relative bg-black h-64 rounded-2xl overflow-hidden mb-4 flex items-center justify-center">
                                        {/* Fake Camera UI */}
                                        <div className="absolute inset-0 flex items-center justify-center">
                                            <div className="w-40 h-56 border-2 border-white rounded-full opacity-50"></div> {/* Face frame */}
                                        </div>
                                        <p className="absolute top-4 text-white text-xs bg-black bg-opacity-50 px-3 py-1 rounded-full">Placez votre visage dans le cadre</p>
                                        <div className="absolute bottom-4">
                                             <button onClick={handleTakeSelfie} className="w-16 h-16 rounded-full border-4 border-white flex items-center justify-center">
                                                <div className="w-12 h-12 bg-white rounded-full"></div>
                                             </button>
                                        </div>
                                        {loading && <div className="absolute inset-0 bg-black flex items-center justify-center"><p className="text-white font-bold animate-pulse">Prise de vue...</p></div>}
                                    </div>
                                )}

                                {selfie && (
                                    <div className="bg-gray-100 h-64 rounded-2xl overflow-hidden mb-4 relative">
                                        <img src={selfie} className="w-full h-full object-cover" />
                                        <button onClick={() => { setSelfie(null); setIsCameraActive(false); }} className="absolute top-2 right-2 bg-white text-gray-800 p-2 rounded-full shadow-sm font-bold text-xs hover:bg-gray-100">Reprendre</button>
                                    </div>
                                )}

                                <div className="flex gap-4">
                                     <button onClick={() => setStep(1)} className="flex-1 bg-gray-100 text-gray-700 py-3 rounded-xl font-bold hover:bg-gray-200">Retour</button>
                                     <button 
                                        onClick={handleFinalSubmit} 
                                        disabled={!selfie || loading}
                                        className={`flex-1 bg-lbc text-white py-3 rounded-xl font-bold transition hover:bg-lbc-hover ${(!selfie || loading) ? 'opacity-50 cursor-not-allowed' : ''}`}
                                    >
                                        {loading ? "Envoi..." : "Soumettre"}
                                    </button>
                                </div>
                            </div>
                        )}

                        {step === 3 && (
                            <div className="text-center py-12">
                                <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <CheckIcon className="h-10 w-10 text-green-600" />
                                </div>
                                <h2 className="text-2xl font-bold text-gray-900 mb-2">Demande envoy√©e !</h2>
                                <p className="text-gray-600 mb-8 max-w-sm mx-auto">
                                    Vos documents ont √©t√© transmis √† notre √©quipe de s√©curit√©. L'analyse prend g√©n√©ralement moins de 24h. Vous recevrez une notification d√®s validation.
                                </p>
                                <button onClick={onBack} className="bg-lbc text-white px-8 py-3 rounded-xl font-bold hover:bg-lbc-hover transition">
                                    Retour √† mon profil
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const LoginPage = ({ onLoginSuccess, onBack, onSignupClick }) => {
            const [identifier, setIdentifier] = React.useState("");
            const [password, setPassword] = React.useState("");
            const [showPassword, setShowPassword] = React.useState(false);
            const [loading, setLoading] = React.useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                setLoading(true);
                setTimeout(() => {
                    setLoading(false);
                    // Default user data on login - NOW UNVERIFIED BY DEFAULT
                    onLoginSuccess({ 
                        name: "Client Bonwaz", 
                        id: 999,
                        bio: "",
                        location: "Libreville, Gabon",
                        avatar: null,
                        phone: "07 00 00 00",
                        verificationStatus: 'none' // 'none', 'pending', 'verified', 'rejected'
                    });
                }, 1000);
            };

            return (
                <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
                    <div className="bg-white w-full max-w-md p-8 rounded-2xl shadow-lg relative">
                         <button onClick={onBack} className="absolute top-4 right-4 text-gray-400 hover:text-gray-800">‚úï</button>
                        <h2 className="text-2xl font-bold text-gray-800 mb-6">Connexion</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">E-mail ou num√©ro de t√©l√©phone</label>
                                <input 
                                    type="text" 
                                    value={identifier} 
                                    onChange={(e) => setIdentifier(e.target.value)} 
                                    placeholder="Ex: 690 12 34 56 ou jean@exemple.com" 
                                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none" 
                                    required 
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Mot de passe</label>
                                <div className="relative">
                                    <input 
                                        type={showPassword ? "text" : "password"} 
                                        value={password}
                                        onChange={(e) => setPassword(e.target.value)}
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                        className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none pr-10" 
                                        required 
                                    />
                                    <button 
                                        type="button"
                                        onClick={() => setShowPassword(!showPassword)}
                                        className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                                    >
                                        {showPassword ? <EyeOffIcon className="h-5 w-5" /> : <EyeIcon className="h-5 w-5" />}
                                    </button>
                                </div>
                            </div>
                            <button type="submit" disabled={loading} className={`w-full bg-lbc text-white py-3 rounded-xl font-bold transition hover:bg-lbc-hover ${loading ? 'opacity-70 cursor-not-allowed' : ''}`}>
                                {loading ? "Connexion..." : "Se connecter"}
                            </button>
                        </form>
                        <p className="mt-6 text-center text-sm text-gray-600">Pas encore de compte ? <button onClick={onSignupClick} className="text-lbc font-bold hover:underline">S'inscrire</button></p>
                    </div>
                </div>
            );
        };

        const SignupPage = ({ onSignupSuccess, onBack, onLoginClick, onTermsClick }) => {
            const [formData, setFormData] = React.useState({ name: "", identifier: "", password: "", confirmPassword: "" });
            const [showPassword, setShowPassword] = React.useState(false);
            const [showConfirmPassword, setShowConfirmPassword] = React.useState(false);
            const [loading, setLoading] = React.useState(false);

            const handleChange = (e) => setFormData({...formData, [e.target.name]: e.target.value});

            const handleSubmit = (e) => {
                e.preventDefault();
                if (formData.password !== formData.confirmPassword) {
                    alert("Les mots de passe ne correspondent pas");
                    return;
                }
                setLoading(true);
                // Simulation API Inscription
                setTimeout(() => {
                    setLoading(false);
                    // On connecte l'utilisateur directement apr√®s l'inscription avec son nom
                    onSignupSuccess({ name: formData.name, id: Date.now(), bio: "", location: "", avatar: null, phone: "" });
                }, 1500);
            };

            return (
                <div className="min-h-screen bg-gray-50 flex items-center justify-center p-4">
                    <div className="bg-white w-full max-w-md p-8 rounded-2xl shadow-lg relative">
                         <button onClick={onBack} className="absolute top-4 right-4 text-gray-400 hover:text-gray-800">‚úï</button>
                        <h2 className="text-2xl font-bold text-gray-800 mb-6">Cr√©er un compte</h2>
                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Nom complet</label>
                                <input 
                                    name="name"
                                    type="text" 
                                    value={formData.name} 
                                    onChange={handleChange} 
                                    placeholder="Ex: Jean Kouassi" 
                                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none" 
                                    required 
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">E-mail ou num√©ro de t√©l√©phone</label>
                                <input 
                                    name="identifier"
                                    type="text" 
                                    value={formData.identifier} 
                                    onChange={handleChange} 
                                    placeholder="Ex: 690 12 34 56" 
                                    className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none" 
                                    required 
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Mot de passe</label>
                                <div className="relative">
                                    <input 
                                        name="password" 
                                        type={showPassword ? "text" : "password"} 
                                        value={formData.password} 
                                        onChange={handleChange} 
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                        className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none pr-10" 
                                        required 
                                    />
                                    <button 
                                        type="button"
                                        onClick={() => setShowPassword(!showPassword)}
                                        className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                                    >
                                        {showPassword ? <EyeOffIcon className="h-5 w-5" /> : <EyeIcon className="h-5 w-5" />}
                                    </button>
                                </div>
                            </div>
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">Confirmer le mot de passe</label>
                                <div className="relative">
                                    <input 
                                        name="confirmPassword" 
                                        type={showConfirmPassword ? "text" : "password"} 
                                        value={formData.confirmPassword} 
                                        onChange={handleChange} 
                                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" 
                                        className="w-full px-4 py-3 rounded-xl border border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none pr-10" 
                                        required 
                                    />
                                    <button 
                                        type="button"
                                        onClick={() => setShowConfirmPassword(!showConfirmPassword)}
                                        className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                                    >
                                        {showConfirmPassword ? <EyeOffIcon className="h-5 w-5" /> : <EyeIcon className="h-5 w-5" />}
                                    </button>
                                </div>
                            </div>
                            <div className="flex items-center gap-2 mt-2">
                                <input type="checkbox" required className="rounded text-blue-600 focus:ring-blue-500" />
                                <span className="text-xs text-gray-500">J'accepte les <button type="button" onClick={onTermsClick} className="underline text-lbc hover:text-blue-700">Conditions G√©n√©rales d'Utilisation</button></span>
                            </div>
                            <button type="submit" disabled={loading} className={`w-full bg-lbc text-white py-3 rounded-xl font-bold transition hover:bg-lbc-hover ${loading ? 'opacity-70 cursor-not-allowed' : ''}`}>
                                {loading ? "Cr√©ation du compte..." : "S'inscrire"}
                            </button>
                        </form>
                        <p className="mt-6 text-center text-sm text-gray-600">D√©j√† un compte ? <button onClick={onLoginClick} className="text-lbc font-bold hover:underline">Se connecter</button></p>
                    </div>
                </div>
            );
        };

        const FavoritesPage = ({ favorites, listings, onViewProduct, onBack }) => {
            const favoriteListings = listings.filter(item => favorites.includes(item.id));
            return (
                <div className="max-w-[1064px] mx-auto px-4 py-8 min-h-screen">
                    <div className="flex items-center gap-4 mb-8">
                        <button onClick={onBack}><ArrowLeftIcon className="h-6 w-6 text-gray-600" /></button>
                        <h2 className="text-2xl font-bold text-gray-900">Mes Favoris ({favoriteListings.length})</h2>
                    </div>
                    {favoriteListings.length === 0 ? (
                        <div className="text-center py-20 bg-white rounded-2xl border border-gray-100">
                            <HeartIcon className="h-16 w-16 text-gray-200 mx-auto mb-4" />
                            <h3 className="text-xl font-bold text-gray-800 mb-2">Aucun favori pour le moment</h3>
                            <button onClick={onBack} className="bg-lbc text-white px-6 py-2 rounded-xl font-bold hover:bg-lbc-hover">D√©couvrir des annonces</button>
                        </div>
                    ) : (
                        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {favoriteListings.map(item => (
                                <div key={item.id} onClick={() => onViewProduct(item)} className="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden cursor-pointer hover:shadow-md transition">
                                    <div className="h-48 bg-gray-200 relative">
                                        <img src={item.image} className="w-full h-full object-cover" />
                                        <div className="absolute top-2 right-2 bg-white p-1.5 rounded-full shadow-sm"><HeartIcon className="h-5 w-5 text-lbc fill-current" filled={true} /></div>
                                    </div>
                                    <div className="p-4">
                                        <h3 className="font-bold text-gray-800 truncate">{item.title}</h3>
                                        <p className="text-lbc font-bold mt-1">{item.price}</p>
                                        <p className="text-xs text-gray-500 mt-2">{item.location}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const InboxPage = ({ conversations, onOpenChat, onBack }) => (
            <div className="max-w-[1064px] mx-auto px-4 py-8 min-h-screen">
                <div className="flex items-center gap-4 mb-8">
                    <button onClick={onBack}><ArrowLeftIcon className="h-6 w-6 text-gray-600" /></button>
                    <h2 className="text-2xl font-bold text-gray-900">Messagerie</h2>
                </div>
                <div className="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                    {conversations.length === 0 ? (
                        <div className="text-center py-20">
                            <MessageIcon className="h-16 w-16 text-gray-200 mx-auto mb-4" />
                            <h3 className="text-xl font-bold text-gray-800 mb-2">Bo√Æte de r√©ception vide</h3>
                        </div>
                    ) : (
                        <div className="divide-y divide-gray-100">
                            {conversations.map(conv => (
                                <div key={conv.id} onClick={() => onOpenChat(conv.product)} className="p-4 hover:bg-gray-50 cursor-pointer flex items-center gap-4 transition">
                                    <div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-lbc font-bold text-lg">{conv.sellerName.charAt(0)}</div>
                                    <div className="flex-1 min-w-0">
                                        <div className="flex justify-between items-baseline mb-1"><h3 className="font-bold text-gray-900">{conv.sellerName}</h3><span className="text-xs text-gray-400">10:30</span></div>
                                        <p className="text-sm text-gray-600 truncate">{conv.lastMessage}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            </div>
        );

        const SearchSection = ({ onSearch, onCategoryClick, selectedCategory }) => {
            const [textQuery, setTextQuery] = React.useState("");
            const [locationQuery, setLocationQuery] = React.useState("");
            const [suggestions, setSuggestions] = React.useState([]);
            const [showSuggestions, setShowSuggestions] = React.useState(false);

            const handleLocationChange = (e) => {
                const value = e.target.value;
                setLocationQuery(value);
                
                if (value.length > 0) {
                    const filtered = ALL_LOCATIONS.filter(loc => 
                        loc.toLowerCase().includes(value.toLowerCase())
                    );
                    setSuggestions(filtered);
                    setShowSuggestions(true);
                } else {
                    setSuggestions([]);
                    setShowSuggestions(false);
                }
            };

            const selectLocation = (loc) => {
                setLocationQuery(loc);
                setShowSuggestions(false);
            };

            const handleSearchClick = () => {
                onSearch(textQuery, locationQuery);
            };

            return (
                <div className="bg-white py-6 border-b border-gray-200">
                    <div className="max-w-[1064px] mx-auto px-4 text-center md:text-left">
                        <h1 className="text-2xl md:text-3xl font-bold text-gray-800 mb-6 hidden md:block">Achetez et vendez en toute confiance pr√®s de chez vous</h1>
                        <div className="bg-gray-100 p-2 rounded-2xl md:flex items-center shadow-sm border border-gray-200 relative z-20">
                            
                            {/* Input Recherche Textuelle */}
                            <div className="flex-1 flex items-center px-4 py-2 border-b md:border-b-0 md:border-r border-gray-300">
                                <SearchIcon className="h-5 w-5 text-gray-500 mr-3" />
                                <input 
                                    type="text" 
                                    value={textQuery}
                                    onChange={(e) => setTextQuery(e.target.value)}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSearchClick()}
                                    placeholder="Que cherchez-vous ?" 
                                    className="bg-transparent w-full outline-none placeholder-gray-500 text-gray-800 font-medium" 
                                />
                            </div>

                            {/* Input Localisation avec Autocomplete */}
                            <div className="flex-1 flex items-center px-4 py-2 relative">
                                <LocationIcon className="h-5 w-5 text-gray-500 mr-3" />
                                <input 
                                    type="text" 
                                    value={locationQuery}
                                    onChange={handleLocationChange}
                                    onKeyPress={(e) => e.key === 'Enter' && handleSearchClick()}
                                    placeholder="Ville ou Quartier (ex: Libreville)" 
                                    className="bg-transparent w-full outline-none text-gray-800 font-medium placeholder-gray-500"
                                    onFocus={() => locationQuery && setShowSuggestions(true)}
                                    // Pour fermer si on clique ailleurs, id√©alement on utiliserait un hook useOnClickOutside
                                    onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}
                                />
                                
                                {showSuggestions && suggestions.length > 0 && (
                                    <div className="absolute top-full left-0 right-0 bg-white shadow-xl rounded-b-xl border border-gray-100 mt-2 max-h-60 overflow-y-auto z-50">
                                        {suggestions.map((loc, idx) => (
                                            <div 
                                                key={idx} 
                                                onClick={() => selectLocation(loc)}
                                                className="px-4 py-3 hover:bg-gray-50 cursor-pointer flex items-center gap-2 text-sm text-gray-700 border-b border-gray-50 last:border-0"
                                            >
                                                <div className="bg-gray-100 p-1.5 rounded-full">
                                                    <LocationIcon className="h-3 w-3 text-gray-500" />
                                                </div>
                                                {loc}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            
                            <button 
                                onClick={handleSearchClick}
                                className="w-full md:w-auto bg-lbc hover:bg-lbc-hover text-white font-bold py-3 px-8 rounded-xl transition mt-2 md:mt-0 shadow-lg"
                            >
                                Rechercher
                            </button>
                        </div>

                        {/* Cat√©gories */}
                        <div className="mt-6 overflow-x-auto no-scrollbar relative z-10">
                            <div className="flex gap-8 min-w-max pb-2">
                                {CATEGORIES.map((cat, index) => (
                                    <div 
                                        key={index} 
                                        onClick={() => onCategoryClick(cat.name)}
                                        className={`flex flex-col items-center gap-2 cursor-pointer group p-2 rounded-lg transition ${selectedCategory === cat.name ? 'bg-blue-100' : 'hover:bg-gray-50'}`}
                                    >
                                        <div className={`w-12 h-12 rounded-full flex items-center justify-center text-2xl transition ${selectedCategory === cat.name ? 'bg-blue-200' : 'bg-blue-50 group-hover:bg-blue-100'}`}>
                                            {cat.icon}
                                        </div>
                                        <span className={`text-xs font-semibold transition ${selectedCategory === cat.name ? 'text-lbc' : 'text-gray-700 group-hover:text-lbc'}`}>
                                            {cat.name}
                                        </span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const ListingCard = ({ item, onClick, onChat, isFavorite, onToggleFavorite }) => (
            <div onClick={onClick} className="group flex flex-col sm:flex-row gap-4 p-4 bg-white rounded-2xl hover:shadow-lg transition border border-transparent hover:border-gray-200 cursor-pointer mb-4 relative">
                <div className="relative w-full sm:w-48 h-48 sm:h-36 flex-shrink-0 rounded-xl overflow-hidden bg-gray-200">
                    <img src={item.image} alt={item.title} className="w-full h-full object-cover group-hover:scale-105 transition duration-300" />
                    <div className="absolute top-2 left-2 flex flex-col gap-1 items-start">
                         {item.isPro && <span className="bg-black text-white text-[10px] font-bold px-2 py-0.5 rounded border border-white shadow-sm">PRO</span>}
                         {item.verified && <span className="bg-green-600 text-white text-[10px] font-bold px-2 py-0.5 rounded border border-white shadow-sm flex items-center gap-1"><svg xmlns="http://www.w3.org/2000/svg" className="h-3 w-3" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" /></svg>V√©rifi√©</span>}
                         {item.isSponsored && <span className="bg-yellow-400 text-yellow-900 text-[10px] font-bold px-2 py-0.5 rounded border border-white shadow-sm flex items-center gap-1"><StarIcon className="h-3 w-3" /> Sponsoris√©</span>}
                    </div>
                </div>
                <div className="flex-1 flex flex-col justify-between">
                    <div>
                        <div className="flex justify-between items-start">
                            <h3 className="text-lg font-bold text-gray-800 line-clamp-2 group-hover:text-lbc transition">{item.title}</h3>
                            <button onClick={(e) => { e.stopPropagation(); onToggleFavorite(item.id); }} className="p-2 hover:bg-blue-50 rounded-full transition -mr-2 -mt-2"><HeartIcon className={`w-6 h-6 ${isFavorite ? 'text-lbc fill-current' : 'text-gray-400'}`} filled={isFavorite} /></button>
                        </div>
                        <p className="text-lbc font-bold text-lg mt-1">{item.price}</p>
                    </div>
                    <div className="flex items-end justify-between mt-4 sm:mt-0">
                        <div className="text-xs text-gray-500"><div className="flex items-center gap-1 mb-1"><span>{item.category}</span><span>‚Ä¢</span><span>{item.location}</span></div><p>{item.date}</p></div>
                        
                        {item.isSponsored ? (
                            <button onClick={(e) => { e.stopPropagation(); onChat(); }} className="flex items-center gap-1 bg-green-100 text-green-700 hover:bg-green-200 px-3 py-1.5 rounded-lg transition text-sm font-bold">
                                <WhatsAppIcon className="h-4 w-4" />
                                <span className="hidden sm:inline">WhatsApp</span>
                            </button>
                        ) : (
                            <button onClick={(e) => { e.stopPropagation(); onChat(); }} className="flex items-center gap-1 bg-blue-100 text-lbc hover:bg-blue-200 px-3 py-1.5 rounded-lg transition text-sm font-bold">
                                <MessageIcon className="h-4 w-4" />
                                <span className="hidden sm:inline">Message</span>
                            </button>
                        )}
                        
                    </div>
                </div>
            </div>
        );

        const MainContent = ({ listings, onViewProduct, onStartChat, favorites, onToggleFavorite, onLoadMore }) => (
            <main className="max-w-[1064px] mx-auto px-4 py-8 pb-24">
                <div className="flex justify-between items-end mb-6"><h2 className="text-xl font-bold text-gray-900">Annonces r√©centes</h2></div>
                <div className="flex flex-col">
                    {listings.length === 0 ? (
                        <div className="text-center py-12 text-gray-500">
                            <p className="text-lg font-medium">Aucun r√©sultat trouv√©.</p>
                            <p className="text-sm">Essayez de modifier votre recherche.</p>
                        </div>
                    ) : (
                        listings.map(item => (
                            <ListingCard key={item.id} item={item} isFavorite={favorites.includes(item.id)} onToggleFavorite={onToggleFavorite} onClick={() => onViewProduct(item)} onChat={() => onStartChat(item)} />
                        ))
                    )}
                </div>
                {listings.length > 0 && (
                    <div className="flex justify-center mt-8">
                        <button onClick={onLoadMore} className="bg-white border border-gray-300 text-gray-800 font-bold py-2 px-6 rounded-xl hover:bg-gray-50 transition shadow-sm">Voir plus d'annonces</button>
                    </div>
                )}
            </main>
        );

        const ProductDetail = ({ product, onBack, onChat }) => (
            <div className="min-h-screen bg-gray-50 pb-20">
                <div className="sticky top-0 bg-white border-b border-gray-200 px-4 h-16 flex items-center gap-4 z-40">
                    <button onClick={onBack} className="p-2 hover:bg-gray-100 rounded-full"><ArrowLeftIcon className="h-6 w-6 text-gray-700" /></button>
                    <span className="font-bold text-lg text-gray-800 truncate">{product.title}</span>
                </div>
                <div className="max-w-4xl mx-auto p-4 md:p-8">
                    <div className="bg-white rounded-2xl shadow-sm overflow-hidden border border-gray-200">
                        <div className="grid md:grid-cols-2 gap-0">
                            <div className="bg-gray-100 aspect-square md:aspect-auto h-[300px] md:h-full relative">
                                <img src={product.image} className="w-full h-full object-cover" />
                                <div className="absolute top-4 right-4 flex flex-col gap-2">
                                     {product.isSponsored && <span className="bg-yellow-400 text-yellow-900 text-xs font-bold px-3 py-1 rounded-full shadow-md flex items-center gap-1"><StarIcon className="h-4 w-4" /> Sponsoris√©</span>}
                                </div>
                            </div>
                            <div className="p-6 flex flex-col justify-between">
                                <div>
                                    <div className="flex justify-between items-start mb-4"><div><h1 className="text-2xl font-bold text-gray-900 mb-2">{product.title}</h1><p className="text-3xl font-bold text-lbc">{product.price}</p></div></div>
                                    <div className="flex items-center gap-2 text-sm text-gray-500 mb-6"><span>{product.date}</span><span>‚Ä¢</span><span>{product.location}</span></div>
                                    <div className="border-t border-gray-100 pt-4 mb-6"><h3 className="font-bold text-gray-900 mb-2">Description</h3><p className="text-gray-700 leading-relaxed">{product.description}</p></div>
                                </div>
                                <div className="bg-gray-50 p-4 rounded-xl border border-gray-100">
                                    <div className="flex items-center gap-3 mb-4"><div className="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center text-lbc font-bold text-xl">{product.seller.charAt(0)}</div><div><p className="font-bold text-gray-900">{product.seller}</p><div className="flex items-center gap-1 text-xs text-green-600"><span className="w-2 h-2 bg-green-500 rounded-full"></span>En ligne</div></div></div>
                                    
                                    {/* MODIFICATION HERE: Conditional Button Rendering */}
                                    <div className={`grid ${product.isSponsored ? 'grid-cols-1 md:grid-cols-2' : 'grid-cols-1'} gap-3`}>
                                        <button onClick={onChat} className={`bg-lbc hover:bg-lbc-hover text-white py-3 rounded-xl font-bold transition flex items-center justify-center gap-2 ${!product.isSponsored ? 'w-full' : ''}`}>
                                            <MessageIcon className="h-5 w-5" />Message
                                        </button>
                                        
                                        {product.isSponsored && (
                                            <button className="bg-green-500 hover:bg-green-600 text-white py-3 rounded-xl font-bold transition flex items-center justify-center gap-2">
                                                <WhatsAppIcon className="h-5 w-5" />WhatsApp
                                            </button>
                                        )}
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        );

        const ChatInterface = ({ product, onBack }) => {
            const [messages, setMessages] = React.useState([{ id: 1, text: `Bonjour, cet article "${product.title}" est-il toujours disponible ?`, sender: 'user' }, { id: 2, text: "Oui, toujours disponible ! Vous √™tes sur quel quartier ?", sender: 'other' }]);
            const [inputText, setInputText] = React.useState("");
            const messagesEndRef = React.useRef(null);
            const scrollToBottom = () => { messagesEndRef.current?.scrollIntoView({ behavior: "smooth" }); }
            React.useEffect(scrollToBottom, [messages]);
            const handleSend = () => {
                if (inputText.trim() === "") return;
                setMessages([...messages, { id: Date.now(), text: inputText, sender: 'user' }]);
                setInputText("");
                setTimeout(() => setMessages(prev => [...prev, { id: Date.now()+1, text: "D'accord, je vous fais un prix.", sender: 'other' }]), 1500);
            };
            return (
                <div className="flex flex-col h-screen bg-gray-100">
                    <div className="bg-white px-4 py-3 border-b border-gray-200 flex items-center gap-3 shadow-sm z-10"><button onClick={onBack}><ArrowLeftIcon className="h-6 w-6 text-gray-600" /></button><div className="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-lbc font-bold">{product.seller.charAt(0)}</div><div className="flex-1"><h3 className="font-bold text-gray-800 leading-none">{product.seller}</h3><span className="text-xs text-gray-500">{product.title} ‚Ä¢ {product.price}</span></div><PhoneIcon className="h-6 w-6 text-green-600" /></div>
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">{messages.map(msg => <div key={msg.id} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}><div className={`max-w-[80%] px-4 py-3 text-sm shadow-sm ${msg.sender === 'user' ? 'bubble-user' : 'bubble-other'}`}>{msg.text}</div></div>)}<div ref={messagesEndRef} /></div>
                    <div className="bg-white p-3 border-t border-gray-200 flex items-center gap-2"><input type="text" className="flex-1 bg-gray-100 rounded-full px-4 py-3 text-sm outline-none focus:ring-2 focus:ring-blue-200 transition" placeholder="√âcrivez votre message..." value={inputText} onChange={(e) => setInputText(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSend()} /><button onClick={handleSend} className="bg-lbc text-white p-3 rounded-full hover:bg-lbc-hover transition shadow-sm"><SendIcon className="h-5 w-5" /></button></div>
                </div>
            );
        };

        const Footer = ({ onNavigate }) => (
             <footer className="bg-white border-t border-gray-200 mt-12 pb-24 md:pb-0">
                <div className="max-w-[1064px] mx-auto px-4 py-12">
                    <div className="grid grid-cols-2 md:grid-cols-4 gap-8 mb-8">
                        <div>
                            <Logo />
                            <ul className="space-y-2 text-sm text-gray-600 mt-4">
                                <li className="hover:underline cursor-pointer" onClick={() => onNavigate('about')}>Qui sommes-nous ?</li>
                                <li className="hover:underline cursor-pointer" onClick={() => onNavigate('partners')}>Nos partenaires</li>
                            </ul>
                        </div>
                        <div>
                            <h4 className="font-bold mb-4 text-gray-900">S√©curit√©</h4>
                            <ul className="space-y-2 text-sm text-gray-600">
                                <li className="hover:underline cursor-pointer" onClick={() => onNavigate('scam')}>Conseils anti-arnaque</li>
                                <li className="hover:underline cursor-pointer" onClick={() => onNavigate('verify')}>V√©rifier un num√©ro</li>
                            </ul>
                        </div>
                        <div>
                            <h4 className="font-bold mb-4 text-gray-900">Support</h4>
                            <ul className="space-y-2 text-sm text-gray-600">
                                <li className="hover:underline cursor-pointer" onClick={() => onNavigate('contact')}>Contactez-nous</li>
                                <li className="hover:underline cursor-pointer" onClick={() => onNavigate('report')}>Signaler une annonce</li>
                                <li className="hover:underline cursor-pointer" onClick={() => onNavigate('terms')}>Conditions G√©n√©rales</li>
                            </ul>
                        </div>
                        <div>
                            <h4 className="font-bold mb-4 text-gray-900">Moyens de paiement</h4>
                            <div className="flex flex-wrap gap-2 text-xs font-bold text-white">
                                <span className="bg-orange-500 px-2 py-1 rounded">Orange Money</span>
                                <span className="bg-yellow-400 text-black px-2 py-1 rounded">MTN MoMo</span>
                                <span className="bg-red-600 px-2 py-1 rounded">Airtel Money</span>
                                <span className="bg-blue-600 px-2 py-1 rounded">Moov Money</span>
                                <span className="bg-indigo-900 px-2 py-1 rounded">Visa</span>
                            </div>
                        </div>
                    </div>
                    <div className="border-t border-gray-200 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-500"><div className="flex items-center gap-4 font-bold text-xl mb-4 md:mb-0"><span>Bonwaz Inc.</span></div><div className="flex gap-2 items-center"><span>¬© 2023 Bonwaz Afrique Centrale</span></div></div>
                </div>
             </footer>
        );

        // --- APP ORCHESTRATOR ---

        const App = () => {
            const [view, setView] = React.useState('home'); // home, detail, chat, login, signup, favorites, inbox, create, alerts, profile, terms, verify_identity
            const [selectedProduct, setSelectedProduct] = React.useState(null);
            const [user, setUser] = React.useState(null); 
            const [listings, setListings] = React.useState(INITIAL_LISTINGS);
            const [favorites, setFavorites] = React.useState([]); 
            const [conversations, setConversations] = React.useState([]);
            const [redirectAfterLogin, setRedirectAfterLogin] = React.useState(null); 
            
            // Search State
            const [filters, setFilters] = React.useState({ query: "", location: "", category: "" });

            // Navigation Helpers
            const goHome = () => { setSelectedProduct(null); setView('home'); window.scrollTo(0,0); };
            const goToLogin = () => setView('login');
            const goToSignup = () => setView('signup');
            const goToFavorites = () => setView('favorites');
            const goToInbox = () => { if(!user) return goToLogin(); setView('inbox'); };
            const goToAlerts = () => { if(!user) return goToLogin(); setView('alerts'); };
            const goToProfile = () => { if(!user) return goToLogin(); setView('profile'); };
            
            const handleFooterNavigate = (targetView) => {
                setView(targetView);
                window.scrollTo(0, 0);
            };

            const goToCreateListing = () => { 
                if(!user) {
                    setRedirectAfterLogin('create'); // Save intention
                    return goToLogin(); 
                }
                setView('create'); 
            };

            const handleLogout = () => { setUser(null); goHome(); };

            const handleLoginSuccess = (userData) => { 
                setUser(userData); 
                // Redirect logic
                if (redirectAfterLogin === 'create') {
                    setView('create');
                    setRedirectAfterLogin(null);
                } else {
                    goHome(); 
                }
            };

            const handleSignupSuccess = (userData) => { 
                setUser(userData); 
                 // Redirect logic (same as login)
                if (redirectAfterLogin === 'create') {
                    setView('create');
                    setRedirectAfterLogin(null);
                } else {
                    goHome(); 
                }
            };
            
            const handleCreateListingSubmit = (newItem) => {
                setListings([newItem, ...listings]);
                goHome();
            };

            const handleUpdateProfile = (updatedUser) => {
                setUser(updatedUser);
            };

            const handleStartVerification = () => {
                setView('verify_identity');
                window.scrollTo(0,0);
            };

            const handleSubmitVerification = () => {
                // Update user status to 'pending'
                setUser({ ...user, verificationStatus: 'pending' });
                // We keep them on the success step of VerificationPage, or redirect to profile after delay logic inside the component.
                // The component logic handles the "Success" view.
            };

            const handleLoadMore = () => {
                alert("Fonctionnalit√© 'Charger plus' simul√©e !");
            };

            const handleToggleFavorite = (id) => {
                setFavorites(prev => prev.includes(id) ? prev.filter(fid => fid !== id) : [...prev, id]);
            };

            const handleViewProduct = (product) => { setSelectedProduct(product); setView('detail'); window.scrollTo(0,0); };

            const handleStartChat = (product) => {
                if (!user) return goToLogin();
                if (product) setSelectedProduct(product);
                if (!conversations.find(c => c.product.id === product.id)) {
                    setConversations([...conversations, { id: Date.now(), product, sellerName: product.seller, productTitle: product.title, lastMessage: "Discussion commenc√©e..." }]);
                }
                setView('chat');
            };

            const handleSearch = (query, location) => {
                setFilters({ query, location, category: "" });
                goHome();
            };

            const handleCategoryClick = (category) => {
                setFilters({ query: "", location: "", category });
                goHome();
            };

            const getFilteredListings = () => {
                return listings.filter(item => {
                    const matchesQuery = filters.query === "" || 
                                         item.title.toLowerCase().includes(filters.query.toLowerCase()) || 
                                         item.description.toLowerCase().includes(filters.query.toLowerCase());
                    const matchesLocation = filters.location === "" || 
                                            item.location.toLowerCase().includes(filters.location.split(',')[0].trim().toLowerCase()); // Simple matching
                    const matchesCategory = filters.category === "" || item.category === filters.category;
                    return matchesQuery && matchesLocation && matchesCategory;
                });
            };

            // RENDERER
            const renderView = () => {
                const filteredListings = getFilteredListings();

                switch(view) {
                    case 'login': return <LoginPage onLoginSuccess={handleLoginSuccess} onBack={goHome} onSignupClick={goToSignup} />;
                    case 'signup': return <SignupPage onSignupSuccess={handleSignupSuccess} onBack={goHome} onLoginClick={goToLogin} onTermsClick={() => handleFooterNavigate('terms')} />;
                    case 'create': return <CreateListingPage onSubmit={handleCreateListingSubmit} onBack={goHome} />;
                    case 'alerts': return <AlertsPage onBack={goHome} />;
                    case 'profile': return <ProfilePage user={user} userListings={listings.filter(l => l.seller.includes("Moi"))} onLogout={handleLogout} onBack={goHome} onUpdateProfile={handleUpdateProfile} onStartVerification={handleStartVerification} />;
                    case 'favorites': return <FavoritesPage favorites={favorites} listings={listings} onViewProduct={handleViewProduct} onBack={goHome} />;
                    case 'inbox': return <InboxPage conversations={conversations} onOpenChat={handleStartChat} onBack={goHome} />;
                    case 'verify_identity': return <VerificationPage onBack={() => setView('profile')} onSubmitVerification={handleSubmitVerification} />;
                    case 'chat': return selectedProduct ? <ChatInterface product={selectedProduct} onBack={() => setView(selectedProduct ? 'detail' : 'inbox')} /> : goHome();
                    case 'detail': return selectedProduct ? <div><ProductDetail product={selectedProduct} onBack={goHome} onChat={() => handleStartChat(selectedProduct)} /><Footer onNavigate={handleFooterNavigate} /></div> : goHome();
                    
                    // Pages Institutionnelles
                    case 'about': return <AboutPage onBack={goHome} />;
                    case 'partners': return <PartnersPage onBack={goHome} />;
                    case 'scam': return <AntiScamPage onBack={goHome} />;
                    case 'verify': return <VerifyNumberPage onBack={goHome} />;
                    case 'contact': return <ContactPage onBack={goHome} />;
                    case 'report': return <ReportPage onBack={goHome} />;
                    case 'terms': return <TermsPage onBack={goHome} />;

                    case 'home': default: return <div><TrustBanner /><SearchSection onSearch={handleSearch} onCategoryClick={handleCategoryClick} selectedCategory={filters.category} /><MainContent listings={filteredListings} onViewProduct={handleViewProduct} onStartChat={handleStartChat} favorites={favorites} onToggleFavorite={handleToggleFavorite} onLoadMore={handleLoadMore} /><Footer onNavigate={handleFooterNavigate} /></div>;
                }
            };

            return (
                <div className="min-h-screen flex flex-col bg-[#f4f6f7]">
                    {view !== 'login' && view !== 'chat' && (
                        <Header user={user} onGoHome={goHome} onLogin={goToLogin} onFavorites={goToFavorites} onMessages={goToInbox} onAlerts={goToAlerts} onCreateListing={goToCreateListing} onProfile={goToProfile} />
                    )}
                    {renderView()}
                    
                    {/* Floating Action Button for Mobile Create Listing */}
                    {view === 'home' && (
                        <button 
                            onClick={goToCreateListing}
                            className="md:hidden fixed bottom-6 right-6 bg-lbc text-white p-4 rounded-full shadow-lg z-50 fab-animation hover:bg-lbc-hover transition"
                        >
                            <PlusIcon className="h-8 w-8" />
                        </button>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);

    </script>
</body>
</html>